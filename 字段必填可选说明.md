# 零改造引擎插件配置 - 字段必填/可选说明

依据新规则规范文档及 `plugin-config.schema.json` 整理，供配置编写参考。

---

## 一、顶层结构

| 字段 | 必填/可选 | 说明 |
|------|:--------:|------|
| desc | **必填** | 应用插件元信息 |
| user_configures | 可选 | UI 配置项映射 |
| gw_configures | **必填** | 网关配置 |

---

## 二、desc 元信息

| 字段 | 必填/可选 |
|------|:--------:|
| plugin_name | **必填** |
| plugin_for_app_name | **必填** |
| plugin_for_app_version | **必填** |
| plugin_version | **必填** |
| plugin_need_engine_version | **必填** |
| plugin_author | **必填** |
| plugin_description | **必填** |
| plugin_last_updated | **必填** |

---

## 三、user_configures 项

| 字段 | 必填/可选 | 说明 |
|------|:--------:|------|
| json_path | **必填** | 指向 gw_configures 的 JSON Path |
| type | **必填** | int / text / bool / json / select / mult_select / enum |
| description | **必填** | 描述信息 |
| label / lable | 可选 | UI 显示标签 |
| value_type | 条件必填 | select / mult_select 时必填 |
| options | 条件必填 | select / mult_select 时必填 |

---

## 四、gw_configures

| 字段 | 必填/可选 | 说明 |
|------|:--------:|------|
| plugins | **二选一必填** | 与 plugin_group_id 二选一 |
| plugin_group_id | **二选一必填** | 与 plugins 二选一（不推荐） |
| sub_routes | 可选 | 子路由配置 |
| plugin_confs | 可选 | 插件配置 |
| plugin_groups | 可选 | 已废弃 |

---

## 五、sub_route 子路由

| 字段 | 必填/可选 | 说明 |
|------|:--------:|------|
| name | **必填** | 子路由名称 |
| routes | **必填** | 路由匹配规则，至少一项 |
| plugins | **二选一必填** | 与 plugin_group_id 二选一 |
| plugin_group_id | **二选一必填** | 与 plugins 二选一（不推荐） |
| desc | 可选 | 子路由描述 |

---

## 六、route_item 路由项

| 字段 | 必填/可选 | 说明 |
|------|:--------:|------|
| uri | **二选一必填** | 与 uris 二选一 |
| uris | **二选一必填** | 与 uri 二选一 |
| methods | 可选 | HTTP 方法 |
| vars | 可选 | 额外匹配条件 |

---

## 七、plugins 内联对象

| 字段 | 必填/可选 |
|------|:--------:|
| name | **必填** |
| conf | **必填** |

---

## 八、plugin_confs 各插件配置

### 8.1 uri_bypass

| 字段 | 必填/可选 |
|------|:--------:|
| filters | 可选 |
| rules | 可选 |

**rules 项**：

| 字段 | 必填/可选 |
|------|:--------:|
| name | **必填** |
| uris | **必填** |
| ip_whitelist | 可选 |
| ip_blacklist | 可选 |
| ip_black_areas | 可选 |

**ip_black_areas 项**：province 必填，city 可选

### 8.2 exposure_session

| 字段 | 必填/可选 |
|------|:--------:|
| key_name | **必填** |
| cookie | 可选 |

**cookie 子字段**：domain、expires、path、secure、httponly、samesite 均为可选

### 8.3 exposure_user

| 字段 | 必填/可选 |
|------|:--------:|
| key_name | **必填** |
| sub_requests | **必填** |
| user_id_var | 可选（推荐） |
| user_name_var | 可选（推荐） |
| cache_key_with_ip | 可选 |
| cache_succ_ttl | 可选 |
| cache_fail_ttl | 可选 |
| cache_size | 可选 |
| connection_keepalive_timeout | 可选 |
| connection_keepalive_pool | 可选 |

**sub_requests 项**：

| 字段 | 必填/可选 |
|------|:--------:|
| name | **必填** |
| uri | **必填** |
| success_expr | **必填** |
| desc | 可选 |
| method | 可选 |
| query | 可选 |
| headers | 可选 |
| body | 可选 |
| exec_expr | 可选 |
| connect_timeout | 可选 |
| send_timeout | 可选 |
| read_timeout | 可选 |
| fetch_vars | 可选 |

### 8.4 uri_blocker / request_blocker

| 字段 | 必填/可选 |
|------|:--------:|
| excludes | 可选 |
| rules | 可选 |
| rejected_msg | 可选 |

---

*依据 plugin-config.schema.json 及插件合规性审计清单整理*
